{% extends 'base.html' %}
{% block content %}
{% load static %}
{% load job_extras %}
<div class="p-3">
  <div class="container">
    <div class="row mt-3">
      <div class="col-md-6 mx-auto mb-3">
        <div class="d-flex justify-content-between align-items-center">
          <h2 class="mb-0">{{ template_data.job.title }}</h2>
          {% if template_data.can_edit %}
            {% if not user.is_job_seeker %}
              <a href="{% url 'jobs.edit' id=template_data.job.id %}" class="btn btn-secondary">Edit Job</a>
            {% endif %}
          {% endif %}
        </div>
        <hr />
        
        <!-- Job Details Section -->
        <div class="card mb-4">
          <div class="card-body">
            <h5 class="card-title">Job Details</h5>
            
            <!-- Location -->
            {% if template_data.job.city or template_data.job.state or template_data.job.country %}
            <div class="mb-2">
              <strong>Location:</strong> 
              {% if template_data.job.city %}{{ template_data.job.city }}{% endif %}{% if template_data.job.state and template_data.job.city %}, {% endif %}{% if template_data.job.state %}{{ template_data.job.state }}{% endif %}{% if template_data.job.country and (template_data.job.city or template_data.job.state) %}, {% endif %}{% if template_data.job.country %}{{ template_data.job.country }}{% endif %}
            </div>
            {% endif %}
            
            <!-- Work Style -->
            {% if template_data.job.work_style %}
            <div class="mb-2">
              <strong>Work Style:</strong> {{ template_data.job.get_work_style_display }}
            </div>
            {% endif %}
            
            <!-- Salary Range -->
            {% if template_data.job.salary_min or template_data.job.salary_max %}
            <div class="mb-2">
              <strong>Salary Range:</strong>
              {% if template_data.job.salary_min %}${{ template_data.job.salary_min|floatformat:"0" }}{% endif %}
              {% if template_data.job.salary_min and template_data.job.salary_max %} - {% endif %}
              {% if template_data.job.salary_max %}${{ template_data.job.salary_max|floatformat:"0" }}{% endif %}
            </div>
            {% endif %}
            
            <!-- Visa Sponsorship -->
            <div class="mb-2">
              <strong>Visa Sponsorship:</strong> 
              {% if template_data.job.visa_sponsorship %}
                <span class="badge bg-success">Available</span>
              {% else %}
                <span class="badge bg-secondary">Not Available</span>
              {% endif %}
            </div>
            
            <!-- Skills -->
            {% if template_data.job.skills %}
            <div class="mb-2">
              <strong>Required Skills:</strong> 
              <div class="mt-1">
                {% for skill in template_data.job.skills|split:"," %}
                  <span class="badge bg-primary me-1">{{ skill|strip }}</span>
                {% endfor %}
              </div>
            </div>
            {% endif %}
            
            <!-- Posted Date -->
            <div class="mb-0">
              <strong>Posted:</strong> {{ template_data.job.date|date:"F d, Y" }}
            </div>
          </div>
        </div>
        
        <!-- Job Description -->
        <div class="card mb-4">
          <div class="card-body">
            <h5 class="card-title">Description</h5>
            <p class="card-text">{{ template_data.job.description|linebreaks }}</p>
          </div>
        </div>

        <!-- Application Section -->
        {% if user.is_authenticated and user.is_job_seeker %}
          {% if not template_data.has_applied %}
            <div class="card shadow mb-4">
              <div class="card-body">
                <h5 class="card-title">Start your application</h5>
                <form method="POST" action="{% url 'jobs.start_application' id=template_data.job.id %}">
                  {% csrf_token %}
                  <div class="mb-3">
                    <label for="user_note" class="form-label">Personalized Note:</label>
                    <textarea name="user_note" required class="form-control" id="user_note" rows="4" placeholder="Tell the employer why you're interested in this position..."></textarea>
                  </div>
                  <div class="text-center">
                    <button type="submit" class="btn bg-dark text-white">Apply Now</button>
                  </div>
                </form>
              </div>
            </div>
          {% else %}
            <div class="alert alert-success" role="alert">
              <h5 class="alert-heading">Application Submitted!</h5>
              You have already applied to this job.
            </div>
          {% endif %}
        {% endif %}
      </div>
      
      <div class="col-md-6 mx-auto mb-3 text-center">
        {% if template_data.job.image %}
        <img src="{{ template_data.job.image.url }}" class="rounded img-card-400" alt="{{ template_data.job.title }}" />
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock content %}